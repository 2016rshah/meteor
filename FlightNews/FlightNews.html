<head>
  <title>FlightNews</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCwNSISshE01c8ewPQzsvV5mC6XRqC7jJU&sensor=false"> </script>
  <script>
  	var google;
  	var myCenter=new google.maps.LatLng(51.508742,-0.120850);
  	var stavanger=new google.maps.LatLng(58.983991,5.734863);
	var amsterdam=new google.maps.LatLng(52.395715,4.888916);
	var london=new google.maps.LatLng(51.508742,-0.120850);
	var geocoder;
	var map;
	var markers=[];
  	function initialize()
	{
		geocoder = new google.maps.Geocoder();
		var mapProp = {center:myCenter, zoom:5, mapTypeId:google.maps.MapTypeId.ROADMAP};
		map=new google.maps.Map(document.getElementById("googleMap"), mapProp);
		 //var marker = new google.maps.Marker({position:myCenter});
		 //marker.setMap(map);
		// var infos = [];
		// var locations = [stavanger, amsterdam, london];
		// for(var i = 0; i<locations.length;i++)
		// {
		//  	markers.push(new google.maps.Marker({position:locations[i], title:i.toString()}));
		//  	markers[markers.length-1].setMap(map);
		//  	i +=1;
		//  	infos.push(new google.maps.InfoWindow({content:"https://www.google.com/"}));
		//  	i -=1;
		//  	infos[i].open(map,markers[i]);
		// }
		// var flightPath = new google.maps.Polyline({path:locations, strokeColor:"#0000FF", strokeOpacity:0.8, strokeWeight:2});
		// flightPath.setMap(map);
		// google.maps.event.addListener(map, 'click', function(event) {
		// 	placeMarker(event.latLng, map);
  //		});
	}
	function placeMarker(location, map) {
		var marker = new google.maps.Marker({
	   	position: location,
	   	map: map,
	   });
	   var infowindow = new google.maps.InfoWindow({
	   	content: 'Latitude: ' + location.lat() + '<br>Longitude: ' + location.lng()
	   });
	 	infowindow.open(map,marker);
	 	google.maps.event.addListener(marker,'click',function() {
			marker.setMap(null);
		});
	}
	function codeDepart() {
		  var address = document.getElementById('depart').value;
		  geocoder.geocode( { 'address': address}, function(results, status) {
		    if (status == google.maps.GeocoderStatus.OK) {
		      map.setCenter(results[0].geometry.location);
		      var indexOf = markers.length;
		      markers.push(new google.maps.Marker({
		          map: map,
		          position: results[0].geometry.location, 
		          title: "depart"
		      }));
		      google.maps.event.addListener(markers[indexOf], 'click', function(){
		      	map.setCenter(markers[indexOf].getPosition());
		      	map.setZoom(12);
		      });
		      map.setZoom(12);
		    } else {
		      alert('Geocode was not successful for the following reason: ' + status);
		    }
		  });
	}
	function codeArrive(){
		var address = document.getElementById('arrive').value;
		geocoder.geocode({'address':address}, function(results, status){
			if(status == google.maps.GeocoderStatus.OK){
				map.setCenter(results[0].geometry.location);
				var indexOf = markers.length;
		      markers.push(new google.maps.Marker({
		          map: map,
		          position: results[0].geometry.location, 
		          title : "arrive"
		      }));
		      google.maps.event.addListener(markers[indexOf], 'click', function(){
		      	map.setCenter(markers[indexOf].getPosition());
		      	map.setZoom(12);
		      });
		      map.setZoom(12);
			}	else{
				alert("Geocode was not successful for the following reason "+status);
			}
		});
	}
	function calcRoute(){
		var locations = [];
		for(var i = 0; i<markers.length; i++){
			if(markers[i].getTitle() == "arrive")
				locations[1] = markers[i].getPosition();
			if(markers[i].getTitle() == "depart")
				locations[0] = markers[i].getPosition();
		}
		var flightPath = new google.maps.Polyline({path:locations, strokeColor:"#0000FF", strokeOpacity:0.8, strokeWeight:2});
		flightPath.setMap(map);
		
		// var midpoint=geo.math.midpoint(locations[0],locations[1]);
		// midpoint = new google.maps.LatLng(midpoint.lat(),midpoint.lng());
		
		
		
		// map.setCenter(midpoint);
		// map.setCenter(locations[0]);
		// map.setZoom(3);
		var bounds = new google.maps.LatLngBounds();
		for (var i = 0; i < locations.length; i++) {
		    bounds.extend(locations[i]);
		}
		map.fitBounds(bounds);
		
	}
	 google.maps.event.addDomListener(window, 'load', initialize);
	 
  </script>
</head>

<body>
  {{> addressFinder}}
  {{> temp}}
</body>

<template name="hello">
  <h1>Hello World!</h1>
  {{greeting}}
  <input type="button" value="Click" />
</template>
<template name = "temp">
	<div id="googleMap" style="width:600px;height:600px;"></div>
</template>
<template name="addressFinder">
	<div id="panel">
		<input type="button" id = "departButton" value="I will depart from here:" onclick="codeDepart()"/>
      <input id="depart" type="textbox" value="Dulles International" onkeydown="if (event.keyCode == 13) document.getElementById('departButton').click()"/>
     	
      <input type = "button" id = "arriveButton" value = "and arrive here:" onclick = "codeArrive()"/>
      <input id = "arrive" type = "textbox" value = "Port Columbus International Airport" onkeydown = "if (event.keyCode == 13) document.getElementById('arriveButton').click()"/>
      
      <br>
      
      <input type = "button" id = "calcRoute" value = "Calculate flight plan" onclick = "calcRoute()"/>
      
    </div>
</template>
